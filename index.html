<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ูุธุงู ูุฏุฑุณุฉ ูุฒูุฏ ุจู ุงูุญุงุฑุซ ุงููุชุทูุฑ</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root { --primary: #1a2a6c; --success: #2ecc71; --danger: #e74c3c; --bg: #f4f7f9; --accent: #f39c12; --dark: #2c3e50; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: var(--bg); margin: 0; padding: 10px; padding-bottom: 110px; direction: rtl; }
        .card { background: #ffffff; border-radius: 15px; padding: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 15px; position: relative; }
        
        /* ุดุฑูุท ุงูููุช ูุงููุนูููุงุช */
        .live-info { background: linear-gradient(135deg, var(--primary), #b21f1f); color: white; padding: 10px 15px; border-radius: 15px; margin-bottom: 15px; text-align: center; display: flex; justify-content: space-around; font-size: 0.85rem; }
        
        .header-card { border-bottom: 4px solid var(--primary); text-align: center; cursor: pointer; }
        .selectors { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        select, input { padding: 12px; border-radius: 10px; border: 1px solid #ddd; width: 100%; box-sizing: border-box; font-size: 1rem; outline: none; }
        
        /* ุดุฑูุท ุฅุญุตุงุฆูุงุช ุงููุนูู ุงูุญูุฉ */
        .stats-bar { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 10px; display: none; }
        .stat-item { padding: 8px; border-radius: 10px; text-align: center; font-size: 0.8rem; color: white; }
        .stat-p { background: var(--success); }
        .stat-a { background: var(--danger); }
        .stat-n { background: var(--accent); }

        #loginArea { display: none; text-align: center; }
        .btn-login { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; margin-top: 10px; cursor: pointer; }

        .record-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .record-table td { padding: 10px; border-bottom: 1px solid #f0f0f0; text-align: center; }
        
        .btn-save { background: var(--success); color: white; border: none; padding: 14px; border-radius: 10px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
        
        #adminPanel { display: none; margin-top: 20px; border-top: 4px double var(--primary); padding-top: 20px; }
        
        /* ูุฑูุช ุงููุฏูุฑ ุงูุฅุญุตุงุฆูุฉ */
        .school-summary { background: var(--dark); color: white; padding: 15px; border-radius: 15px; margin-bottom: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; text-align: center; }
        .summary-box { border: 1px solid rgba(255,255,255,0.2); padding: 10px; border-radius: 10px; }
        .summary-box span { display: block; font-size: 1.2rem; font-weight: bold; }

        .class-table { width: 100%; font-size: 0.85rem; border-collapse: collapse; margin-top: 10px; }
        .class-table th { background: #eee; padding: 8px; }
        .class-table td { border: 1px solid #eee; padding: 8px; text-align: center; }

        /* ุชุตููุฉ ุงูุจุญุซ ุงูุญูุฉ */
        .search-area { background: #fff; padding: 15px; border-radius: 15px; border: 2px solid var(--accent); margin-bottom: 15px; position: relative; }
        #suggestionsList { position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #ddd; z-index: 1000; border-radius: 0 0 10px 10px; max-height: 200px; overflow-y: auto; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .suggestion-item { padding: 10px; border-bottom: 1px solid #f0f0f0; cursor: pointer; text-align: right; }
        .suggestion-item:hover { background: #f9f9f9; }
        
        .name-tag { background: #fff5f5; color: var(--danger); padding: 4px 10px; border-radius: 15px; font-size: 0.75rem; margin: 3px; border: 1px solid #ffdada; display: inline-block; }
        .abs-count-badge { background: var(--danger); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8rem; }

        .page-footer { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(255, 255, 255, 0.97); backdrop-filter: blur(8px); border-top: 2px solid var(--primary); padding: 15px 0; text-align: center; z-index: 1000; }
        .sig-name { color: #333; font-size: 1rem; font-weight: 800; }
    </style>
</head>
<body>

<div class="live-info">
    <div>๐ <b id="liveDate"></b></div>
    <div>โฐ <b id="liveTime"></b></div>
</div>

<div class="card header-card" onclick="adminShortcut()">
    <h2 style="margin:0; color:var(--primary);">๐ด๐ฒ ูุฏุฑุณุฉ ูุฒูุฏ ุจู ุงูุญุงุฑุซ</h2>
    <div class="selectors">
        <select id="classSelect" onchange="fetchClassData()">
            <option value="">-- ุงุฎุชุฑ ุงูุตู --</option>
            <optgroup label="ุฎุงูุณ"><option value="5-1">ุฎุงูุณ 1</option><option value="5-2">ุฎุงูุณ 2</option><option value="5-3">ุฎุงูุณ 3</option></optgroup>
            <optgroup label="ุณุงุฏุณ"><option value="6-1">ุณุงุฏุณ 1</option><option value="6-2">ุณุงุฏุณ 2</option></optgroup>
            <optgroup label="ุณุงุจุน"><option value="7-1">ุณุงุจุน 1</option><option value="7-2">ุณุงุจุน 2</option><option value="7-3">ุณุงุจุน 3</option></optgroup>
            <optgroup label="ุซุงูู"><option value="8-1">ุซุงูู 1</option><option value="8-2">ุซุงูู 2</option></optgroup>
        </select>
        <select id="lessonSelect" onchange="fetchClassData()">
            <option value="1">ุงูุญุตุฉ 1</option><option value="2">ุงูุญุตุฉ 2</option><option value="3">ุงูุญุตุฉ 3</option>
            <option value="4">ุงูุญุตุฉ 4</option><option value="5">ุงูุญุตุฉ 5</option><option value="6">ุงูุญุตุฉ 6</option><option value="7">ุงูุญุตุฉ 7</option>
        </select>
    </div>
    
    <div id="teacherStats" class="stats-bar">
        <div class="stat-item stat-n">ุงูุนุฏุฏ: <b id="tTotal">0</b></div>
        <div class="stat-item stat-a">ุบูุงุจ: <b id="tAbs">0</b></div>
        <div class="stat-item stat-p">ุญุถูุฑ: <b id="tPerc">0%</b></div>
    </div>
</div>

<div id="loginArea" class="card">
    <h4 style="margin:0;">ููู ุงููุฏูุฑ</h4>
    <input type="password" id="passInput" placeholder="ุฃุฏุฎู ุฑูุฒ ุงูุฏุฎูู...">
    <button class="btn-login" onclick="checkPassword()">ุฏุฎูู</button>
</div>

<div id="mainAppArea" style="display:none;" class="card">
    <table class="record-table"><tbody id="studentsList"></tbody></table>
    <button class="btn-save" onclick="pushToCloud()">ุญูุธ ุจูุงูุงุช ุงูุญุตุฉ โ</button>
</div>

<div id="adminPanel">
    <div class="school-summary">
        <div class="summary-box">ุฅุฌูุงูู ุงูุทูุงุจ <span id="sTotal">0</span></div>
        <div class="summary-box">ุฅุฌูุงูู ุงูุบูุงุจ <span id="sAbs">0</span></div>
        <div class="summary-box">ูุณุจุฉ ุงูุญุถูุฑ <span id="sPresPerc">0%</span></div>
        <div class="summary-box">ูุณุจุฉ ุงูุบูุงุจ <span id="sAbsPerc">0%</span></div>
    </div>

    <div class="card">
        <h4 style="margin-top:0;">๐ ุฅุญุตุงุฆูุฉ ุงูุตููู</h4>
        <table class="class-table">
            <thead>
                <tr><th>ุงูุตู</th><th>ุงูุทูุงุจ</th><th>ุบูุงุจ</th><th>ุญุถูุฑ %</th></tr>
            </thead>
            <tbody id="classesStatsBody"></tbody>
        </table>
    </div>

    <div class="search-area">
        <label>๐ ุจุญุซ ุฐูู ุนู ุทุงูุจ:</label>
        <input type="text" id="globalSearchInput" placeholder="ุงูุชุจ ุฌุฒุกุงู ูู ุงูุงุณู..." oninput="showSuggestions(this.value)">
        <div id="suggestionsList" style="display:none;"></div>
        <div id="searchResultArea" style="margin-top:15px;"></div>
    </div>

    <div class="card" style="background: #e3f2fd; border: 2px solid #2196f3;">
        <h4 style="margin:0; color: #0d47a1;">๐ฅ ุงุณุชุฎุฑุงุฌ ุงูุณุฌูุงุช (Excel)</h4>
        <button onclick="exportToExcel()" style="background: #2196f3; color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; width: 100%; font-weight: bold; margin-top: 10px;">
            ุชุญููู ุณุฌู ุงูุบูุงุจ ุงูุดุงูู โฌ๏ธ
        </button>
    </div>

    <div class="card" style="background:#eef2f7;">
        <label>๐ ูุฑุงุฌุนุฉ ุชุงุฑูุฎ ุณุงุจู:</label>
        <input type="date" id="archiveDate" onchange="generateDetailedReport()">
    </div>

    <div id="detailedReportArea"></div>
</div>

<footer class="page-footer">
    <div style="font-size: 0.75rem; color: var(--primary);">ูุฏูุฑ ุงููุฏุฑุณุฉ ุงูุฃุณุชุงุฐ</div>
    <div class="sig-name">ูุดุงู ุงููุญุงูู</div>
</footer>

<script>
    // ุชูููู Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAzmsbAn5jVh293t7X79NmyzSZFDFXFpdg",
      authDomain: "oman-school-app.firebaseapp.com",
      projectId: "oman-school-app",
      databaseURL: "https://oman-school-app-default-rtdb.firebaseio.com",
      appId: "1:600597013448:web:c4ee843ae91c94a1e396fd"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // ุงููุงุฆูุฉ ุงููุงููุฉ ููุทูุงุจ ูุน ุงูุชุนุฑูุจ
    const ALL_STUDENTS = {
        "5-1": ["ุฃุญูุฏ ุจู ุณุงูู ุจู ุณุนูุฏ ุญุณู ุฎูุงุฑ", "ุงูุงููู ูุญูุฏ ุงุญูุฏ ุงูุทูุจ", "ุชุฑูู ุจู ูุญูุฏ ุจู ุณุนูุฏ ูุณูู ูุณู", "ุฎุงูุฏ ุจู ุฑุงุดุฏ ุจู ุณุนูุฏ ุณุงูู ูุณู", "ุณุงูู ุจู ูุญูุฏ ุจู ุณุงูู ุตุงูุญ ุฌุฏุงุฏ", "ุณุงูู ุจู ูุณูู ุจู ุณููู ูุญูุฏ ุงูุฑุงุดุฏู", "ุณุนูุฏ ุจู ุณุงูู ุจู ุธูููุฑ ุณุงูู ุฌุฏุงุฏ", "ุณุนูุฏ ุจู ุดูุงุจ ุจู ูุงูุน ูุณูู ุงููุณููู ุงููุซูุฑู", "ุณุนูุฏ ุจู ุนุจุฏุงููู ุจู ุจูุงู ุฎููุฏุน ุฎูุงุฑ", "ุณูุทุงู ุจู ูุญูุฏ ุจู ุนูู ูููู ุงูุนุงูุฑู", "ุนุงูุฑ ุจู ุณููู ุจู ุนุงูุฑ ุณูููู ููุตูุช", "ุนุจุฏุงูุฑุญูู ุงุญูุฏ ููุฒู ุนุจุฏุงููุชุงุญ", "ุนูู ุจู ุณุนุฏ ุจู ูุณูู ุณุนูุฏ ุงูุฑุงุดุฏู", "ุนูุถ ุจู ูุญูุฏ ุจู ุนูุถ ุฎุงุฏู ุงููููุจู", "ุบุงูู ุจู ูุญูุฏ ุจู ุณููู ูุณูู ุงูุฌููุจู", "ุบุงูู ุจู ูุญูุฏ ุจู ูุจุงุฑู ุจุฎูุช ุฌุฏุงุฏ", "ูุญูุฏ ุงุญูุฏ ูุญููุฏ ุนุจุฏุงูุญููุฏ", "ูุญูุฏ ุจู ูุณูู ุจู ูุญูุฏ ุจุฎูุช ูุณู", "ูุงูู ุจู ูุญูุฏ ุจู ุณุงูู ุณููู ูุณู", "ููุฏุงู ุจู ุงุญูุฏ ุจู ุนุจุฏุงููู ูุญูุฏ ุฌุฏุงุฏ"],
        "5-2": ["ุฃุญูุฏ ุจู ุณุนูุฏ ุจู ูุณูู ุฃุญูุฏ ุฌุฏุงุฏ", "ุฃูุฌุฏ ุจู ุณุนูุฏ ุจู ุฎููุณ ุณุนูุฏ ุงูุดูููู", "ุงูุจุฑุงุก ุงุญูุฏ ุณููุญ ุนูู ุณูุฏ", "ุฎุงูุฏ ุจู ุฃุญูุฏ ุจู ูุณูู ูุญูุฏ ูุณู", "ุฎุงูุฏ ุจู ูุญูุฏ ุจู ูุณูู ุณูููุฑ ุฎูุงุฑ", "ุณุงูู ุจู ุญูุฏ ุจู ูุจุฎูุช ุญูุงุฏู ุฌุฏุงุฏ", "ุณุงูู ุจู ุนูุถ ุจู ุณุงูู ูุญูุฏ ูุณู", "ุณุงูู ุจู ูุงูู ุจู ุณุงูู ุนูุถู ุฌุฏุงุฏ", "ุณุนูุฏ ุจู ุจุฎูุช ุจู ุนุจุฏู ุจุฎูุช ุฎูุงุฑ", "ุณุนูุฏ ุจู ุฎุงูุฏ ุจู ุจุฎูุช ุฒุงูุฏ ูุณู", "ุณุนูุฏ ุจู ุตุงูุญ ุจู ุณููู ุนูู ุจูุช ุฌุฏุงุฏ", "ุณููุงู ุจู ูุงุฌู ุจู ุณุงูู ุณุนุฏ ุฎูุงุฑ", "ุณููู ุจู ูุนูุฑ ุจู ุณููู ูุณูู ุฌุฏุงุฏ ุงููุซูุฑู", "ุตุงูุญ ูุญูู ูุณูู", "ุตูุฑ ุจู ูุญูุฏ ุจู ุงูุนุจุฏ ุณููู ุฌุฏุงุฏ", "ุนุจุฏุงูุฑุญูู ุณุงูู ูุญูุฏ ุงุญูุฏ ููุณู ุงููุฒูู", "ูุญูุฏ ุจู ุจุฎูุช ุจู ุงุญูุฏ ูุญูุฏ ูุณู", "ูุญูุฏ ุจู ุณุงูู ุจู ุณููู ูุทุฑ ุฌุฏุงุฏ", "ูุญูุฏ ุจู ุนุงูุฑ ุจู ูุญูุฏ ุงุญูุฏ ุงููุณููู", "ูุญูุฏ ุจู ุบุงุฒู ุจู ูููุด ุฌุนูุฏ ุฌุฏุงุฏ ุงููุซูุฑู", "ูุญูุฏ ุจู ููุฏ ุจู ุณุงูู ุฎููุชู ูุณู", "ูุณูู ุจู ุจุฎูุช ุจู ุนุจุฏู ุจุฎูุช ุฎูุงุฑ"],
        "5-3": ["ุฅููุงุณ ุจู ุงุจุฑุงููู ุจู ุญูุฏ ูุณุนูุฏ ุงูุนุงูุฑู", "ุชูููุฑ ุจู ุฃุญูุฏ ุจู ูุจุฑูู ุฃุญูุฏ ูุณู", "ุฎุงูุฏ ุฃุญูุฏ ุญุณู ุงูุชุงุจุนู", "ุฎุงูุฏ ุจู ุนูุฑู ุจู ุบููู ุณุงูู ุฎูุงุฑ", "ุณุงูู ุจู ุนูุงุฏ ุงูููุณุงูู", "ุดูุงุจ ุจู ุญูุฏ ุจู ูุญูุฏ ุญูุฏ ุงูููุงุฆู", "ุนุจุฏุงููู ุจู ูุญูุฏ ุจู ุนูุธู ุณุนูุฏ ุฌุฏุงุฏ ุงููุซูุฑู", "ููุฏ ุจู ูุญูุฏ ุจู ุณุงูู ูุณูู ุงููุณููู", "ููุตู ุจู ุญูุฏ ุจู ูุญูุฏ ุญูุฏ ุงูููุงุฆู", "ูุงุฒู ูุตุทูู ูุญูุฏ ุงุญูุฏ ุนูู", "ูุญูุฏ ุจู ุญุณูู ุจู ุณุงูู ูุจุฎูุช ุฎูุงุฑ", "ูุญูุฏ ุจู ุณุนูุฏ ุจู ุณุงูู ุฎููุชู ูุณู", "ูุฑูุงู ุณูุงูู ุญุณูู ุนูู ุดููู", "ูุณูู ุจู ุณุนูุฏ ุจู ุณุนุฏ ุณุนูุฏ ุฌุฏุงุฏ", "ูุณูู ุจู ูุญูุฏ ุจู ูุณูู ุงุญูุฏ ุฌุฏุงุฏ", "ููุซู ุจู ููุงุฒ ุจู ุณูููุงู ุนุจุฏุงููู ุงููุงุดูู"],
        "6-1": ["ุงูุฎุทุงุจ ูุญูุฏ ุญูุฏ ุงูููู ุงุญูุฏ", "ุงูุฎููู ุจู ุบุณุงู ุจู ุทุงูุจ ุจุฏุฑ ุงูุตูุตุงูู", "ุงููุฌุฑุณ ุจู ุณูููุงู ุจู ูุจุงุฑู ุณูููุงู ุงูุญุจุณู", "ุงูุณ ูุญููุฏ ูุญูุฏ ุงุญูุฏ", "ุงูุงุจ ุนุจุฏุงูุนุธูู ุญุณูู ุงูุทุงูุฑ", "ุญุณูู ูุญูุฏ ููุณู ุฎุถุฑ", "ุณุงูู ุจู ุซุงูู ุจู ูุญูุฏ ุจุฎูุช ุฎูุงุฑ", "ุณุงูู ุจู ุญููุฏ ุจู ุณุงูู ุณุนูุฏ ุงููุงุฆูู", "ุณุงูู ุจู ูุญูุฏ ุจู ุณุงูู ุนุจุฏุงููู ุงูุฑุงุดุฏู", "ุณุนูุฏ ุจู ุนุจุฏุงูุนุฒูุฒ ุจู ุจุฎูุช ุญู ูุณู", "ุณุนูุฏ ุจู ุญุงุชู ุจู ุณุนูุฏ ูุญูุฏ ุจูุช ูุณู", "ุณุนูุฏ ุจู ูุณูู ุจู ุณุนูุฏ ุณููู ูุณู", "ุณููู ุจู ุณููู ุจู ุณููู ุณููู ููุตูุช", "ุณููู ูุญุณู ุณููู ุงู ุฎูุงุฑ", "ุณูู ุจู ุฎููุณ ุจู ุณุงูู ูุญูุฏ ุงูุฌููุจู", "ุณูู ุจู ูุงุฆู ุจู ุนุจุฏุงููู ูุจุงุฑู ุฌุฏุงุฏ", "ุนุจุฏ ุงูุฑุญูู ุจู ูุญูุฏ ุจู ุณุนูุฏ ุณุงูู ูุณู", "ุนุจุฏุงููู ุจู ุบุงูู ุจู ุณุงูู ุนุจุฏุงููู ุงูุฑุงุดุฏู", "ุนุจุฏุงููู ุจู ูุญูุฏ ุจู ุงุญูุฏ ุฑูููุงู ุฎูุงุฑ", "ุนุจุฏุงููู ุนูุงุถ ุนุจุฏุงููู ุนุจุฏุงููุทูู", "ุนูู ุจู ุญุงูุฏ ุจู ูุณูู ูุญูุฏ ูุณู ุงููุซูุฑู", "ุนูู ุจู ุณุนูุฏ ุจู ูุญูุฏ ุณุงูู ุฎูุงุฑ", "ูุจุฑูู ุจู ูุญูุฏ ุจู ุณุงูู ุธูููุฑ ุฌุฏุงุฏ", "ูุชุนุจ ุจู ุณุนูุฏ ุจู ุนุจุฏุงููู ูุญูุฏ ุฌุฏุงุฏ", "ูุญูุฏ ุจู ุฌููู ุจู ุนุจุฏู ุจุฎูุช ุฎูุงุฑ", "ูุณูู ุจู ุจุฏุฑ ุจู ูุณูู ุณุนูุฏ ูุณู", "ูุณูู ุจู ูุญูุฏ ุจู ูุณูู ุณุนูุฏ ุฌุฏุงุฏ"],
        "6-2": ["ุงูููุซ ุจู ุฅุจุฑุงููู ุจู ูุงุตุฑ ุนูู ุงูุญูุณูู", "ุงููุบูุฑู ุจุดุฑู ูุญุฌูุจ ุงุญูุฏ", "ุจุฎูุช ุจู ุณุนูุฏ ุจู ูุจุงุฑู ุจุฎูุช ุฌุฏุงุฏ", "ุณุงูู ุจู ุงุญูุฏ ุจู ุณููู ุณุงูู ุฎูุงุฑ", "ุณุงูู ุจู ุญุงุชู ุจู ุณุงูู ุณุนุฏ ุฎูุงุฑ", "ุณุงูู ุจู ุณูุทุงู ุจู ุณููู ุบุงูู ุงูุฑุงุดุฏู", "ุณุงูู ุจู ุณููู ุจู ุณุงูู ุงููุญูุงุก ุฌุฏุงุฏ", "ุณุนุฏ ุจู ูุฑุงูู ุจู ุณุงูู ุนูู ุฎูุงุฑ", "ุณุนูุฏ ุจู ุนุงุฏู ุจู ุณุงูู ุฎููุชู ูุณู ุจูุช ูุซูุฑ", "ุณูุทุงู ุจู ูุณูู ุจู ุณูุทุงู ุงุณุฏ ุงูุฑุงุดุฏู", "ุนุงูุฑ ุจู ุฎุงูุฏ ุจู ุณุงูู ูุณู", "ุนุจุฏุงููู ุจู ุญุณูู ุจู ุนูู ูุญูุฏ ุงู ุนุจุฏุงูุณูุงู", "ุนุจุฏุงููู ุจู ุนุจุฏู ุจู ุจุฎูุช ุฒููุฉ ุฎูุงุฑ", "ุนุจุฏุงููู ุณุนูุฏุงู ุณูุนุฏ ุงูุฑุงุดุฏู", "ุบุงุฒู ุจู ูุญูุฏ ุจู ุตุงูุญ ุงุญูุฏ ุฌุฏุงุฏ", "ุบูุซ ุจู ุงุญูุฏ ุจู ุจุฎูุช ูุนููู ุงููุณููู", "ูุงุฒู ุชุงูุฑ ูุญูุฏ ูุญูุฏ ุนููุด", "ูุงุฒู ุนุจุฏุงูุณููุน ุณูููุงู ุฎููุณ", "ูุงูุฑ ุจู ูุญูุฏ ุจู ูุณุชููู ูุญูุฏ ุตูุฑุงุฑ", "ูุญูุฏ ุจู ุนุจุฏุงููู ุจู ูุญูุฏ ุนุจุฏุงููู ุฎูุงุฑ", "ูุญูุฏ ุญุงูุธ ุณุนูุฏ ุฑุนููุช", "ูุญูุฏ ูุญุณู ุณููู ุงู ุฎูุงู", "ูุฏุฑู ุจู ุฎุงูุฏ ุจู ุณุนูุฏ ุจุฎูุช ุงูุดุนุดุนู", "ูุณูู ุจู ุณุงูู ุจู ุนุจุฏุงููู ุณุนูุฏ ุงูุฑุงุดุฏู", "ูุณูู ุจู ูุญูุฏ ุจู ุณุนูุฏ ูุณูู ุฌุฏุงุฏ", "ููุณู ุจู ูุญูุฏ ุจู ุจุฎูุช ุณุงูู ุฎูุงุฑ", "ููุณู ุนูุงุฏ ุงูููุณุงูู"],
        "7-1": ["ุฃุญูุฏ ุงูุฌุฏ ุงุญูุฏ ุฃุญูุฏ ูุฌุงุฏ", "ุฃุญูุฏ ุจู ุณุนูุฏ ุจู ุตุงูุญ ุฃุญูุฏ ุฌุฏุงุฏ", "ุงูุนุจุฏ ุจู ูุญูุฏ ุจู ุงูุนุจุฏ ุฒุงุฆุฏ ูุณู", "ุงููุงุจู ุจู ูุญูุฏ ุจู ุณุงูู ุณููู ูุณู", "ุจุฎูุช ุจู ุงุญูุฏ ุจู ุจุฎูุช ูุฑูุญ ูุณู ุงููุซูุฑู", "ุชููู ุจู ูุญูุฏ ุจู ุณููู ุฌุฏูุฏ ุฌุฏุงุฏ ุงููุซูุฑู", "ุชููู ุจู ูุญูุฏ ุจู ูุจุฑูู ุนุจุฏุงููู ุงููุณููู", "ุญูุฏ ุจู ูุญูุฏ ุจู ุงุญูุฏ ุงููุฒุงุฑ ุงููุซูุฑู", "ุญูุฏ ุจู ูุญูุฏ ุจู ุณุนูุฏ ูุณู", "ุฑุงุดุฏ ุจู ูุญูุฏ ุจู ุฃุญูุฏ ูุญูุฏ ูุณู ุงููุซูุฑู", "ุณุงูู ุจู ุณุนุฏ ุจู ุตูุงุญ ุฑุนููุช", "ุณุนูุฏ ุจู ุดูุงุจ ุจู ุงุญูุฏ ูุญูุฏ ูุณู", "ุณุนูุฏ ุจู ูุญูุฏ ุจู ุตุงูุญ ุฌุฏุงุฏ", "ุณุนูุฏ ุจู ูุญูุฏ ุจู ูุจุงุฑู ุจุฎูุช ุฌุฏุงุฏ", "ุณูุทุงู ุจู ุญูุฒุฉ ุจู ูุณูู ููู ุฑุจุนุงุช ุงููุซูุฑู", "ุนุงูุฑ ุจู ูุญูุฏ ุจู ูุณูู ุจุฎูุช ุงููุณููู", "ุนุจุฏุงููู ุจู ุณุงูู ุจู ุณููู ุณููู ููุตูุช", "ุนูุฑ ุงุญูุฏ ูุญูุฏ ุงุญูุฏ", "ุนูุฑ ุนุจุฏุงูููู ุงุจุฑุงููู ุงุจุฑุงููู", "ูุฑูุญ ุจู ุนุจุฏุงููู ุจู ูุฑูุญ ุงุญูุฏ ูุณู", "ูุฌุชุจู ุนูุณู ูุญูุฏ", "ูุณูู ุจู ูุญูุฏ ุจู ุนูุถ ุฎุงุฏู ุงููููุจู", "ูุตุฑ ุจู ุณุงูู ุจู ุธูููุฑ ุณุงูู ุฌุฏุงุฏ", "ูุงุณุฑ ุจู ุนุงุฏู ุจู ุณุงูู ูุณู ุจูุช ูุซูุฑ", "ููุณู ุนูุฑ ุงุญูุฏ ุนุจุฏ ุงูุฑุญูู ุญุงูู"],
        "7-2": ["ุงุจุฑุงููู ูุญูุฏ ุณุงูู ุงูุณุทุฑู", "ุงูุนุจุงุณ ุจู ูุจุฎูุช ุจู ุณุงูู ูุณู ุจูุช ูุซูุฑ", "ุงูููุฐุฑ ุจู ููุงุฒ ุจู ุณูููุงู ุนุจุฏุงููู ุงููุงุดูู", "ุงููุฑ ุจู ูุงุตุฑ ุจู ุนุจุฏุงูุฑุญูู ุนุจุฏุงููู ุงูุจููุดู", "ุญุณูู ุณูุงูู ุญุณูู ุนูู ุดููู", "ุฎุงูุฏ ุจู ุณุงูู ุจู ุนูู ุนุจุฏุงููู ุงูุนููู", "ุฎุงูุฏ ุจู ูุญูุฏ ุจู ุณููู ูุทุฑ ุฌุฏุงุฏ", "ุฎุงูุฏ ุจู ูุณูู ุจู ุฃุญูุฏ ุฌุฏุงุฏ", "ุฑููุฒู ุจู ูุณูู ุจู ุจุฎูุช ุฑููุฒู ุตูุฏู ุงููุญุฑูู", "ุณุงูู ุจู ูุจุงุฑู ุจู ุณููู ูุญูุฏ ุงูุฑุงุดุฏู", "ุณุนุฏ ุจู ูุญูุฏ ุจู ุณุนุฏ ุญููุธ ุฎูุงุฑ", "ุณุนูุฏ ุจู ุนุจุฏุงููู ุจู ุจุฎูุช ุฒุงูุฏ ูุณู", "ุณุนูุฏ ุจู ุนุจุฏุงููู ุจู ุณุงูู ุงุญูุฏ ุฌุฏุงุฏ", "ุณุนูุฏ ุจู ูุณูู ุจู ุนุจุฏุงููู ุณุนูุฏ ุฌุฏุงุฏ", "ุณูุทุงู ุจู ูุณูู ุจู ุณุงูู ุตุงูุญ ุฌุฏุงุฏ", "ุนุจุฏุงููู ุจู ุนุงุฑู ุจู ุณุงูู ุฌุฏุงุฏ", "ุนูู ุจู ุณุนูุฏ ุจู ุนูู ุฎูุงุฑ", "ุนูุฑ ูุคุงุฏ ูููู ูุญูุฏ ูุคุงุฏ", "ููุฏ ุจู ุบุงูู ุจู ุณุงูู ุฌุฏุงุฏ", "ูุญุณู ูุนุชุตู ูุญูุฏ ุงูุงูุงู", "ูุญูุฏ ุจู ุณุงูู ุจู ูุจุฎูุช ูุญูุฏ ุงูุฑุงุดุฏู", "ูุณูู ุจู ุณุงูู ุจู ุณููู ุงูุฑุงุดุฏู", "ูุตุทูู ูุญููุฏ ูุฑูู ุงุจุฑุงููู ุงุญูุฏ", "ูุนุงุฐ ุงุญูุฏ ุณููุญ ุนูู ุณูุฏ", "ูููู ุจู ุณุนูุฏ ุจู ูุญูุฏ ุณุงูู ุฌุฏุงุฏ", "ูุงุฏู ุจู ุณุนูุฏ ุจู ูุงุฏู ุญุณู ุดุญุฑู ุฎูุงุฑ", "ูุงุฆู ุจู ุญููุฏ ุจู ุณุงูู ุณุนูุฏ ุงููุงุฆูู"],
        "7-3": ["ุฃุญูุฏ ุจู ูุงุฆู ุจู ุนุจุฏุงููู ูุญูุฏ ุฌุฏุงุฏ", "ุงูุทูุญ ุจู ุณุงูู ุจู ุญุณู ุนูู ุฎูุงุฑ", "ุจุฎูุช ุจู ูุณูู ุณุงูู ูุจุฎูุช ุงูุฑุงุดุฏู", "ุจุฏุฑ ุจู ุนุงูุฑ ุจู ูุณูู ุงูุฑุญุงุจู ุฌุฏุงุฏ", "ุญุซูุซ ุจู ุณูุทุงู ุจู ูุญูุฏ ุณููู ูุณู", "ุญูุฏ ุจู ูุญูุฏ ุจู ุนุจุฏุงููู ูุญูุฏ ุฌุฏุงุฏ ุงููุซูุฑู", "ุณุงูู ุจู ุงุญูุฏ ุจู ุณุงูู ุฌุฏุงุฏ", "ุณุนูุฏ ุจู ูุจุฑูู ุจู ุณุงูู ุนุงูุฑ ุงููุณููู", "ุณููู ุจู ุนุจุฏุงููู ุจู ุณููู ุญุงูุธ ุฎูุงุฑ", "ุนุจุฏ ุงููู ุฃููุฑ ุนุจุฏุงููู ูุตุฑ", "ุนุจุฏุงููู ุจู ูุญูุฏ ุจู ุนูู ูููู ุงูุนุงูุฑู", "ุนูู ุจู ุซุงูู ุจู ุนูู ุณุงูู ุฌุฏุงุฏ ุจูุช ูุซูุฑ", "ูุงุฑุณ ุฒูุงุฏ ูุญูุฏ ุงุจู ุฑูุงุน", "ูุจุงุฑู ุจู ุณุนูุฏ ุจู ุณุงูู ุฎููุชู ูุณู", "ูุญุณู ุจู ุนููู ุจู ุณุงูู ุณุนุฏ ุฎูุงุฑ", "ูุญูุฏ ุจู ุจุฎูุช ุจู ูุฑุฌ ุงูุณูุญ ุดููุงู ุงูููุฑู", "ูุญูุฏ ุจู ุนูู ุจู ุจุฎูุช ูุญูุฏ ุงูุฑุงุดุฏู", "ูุญูุฏ ุจู ุบุงูู ุจู ุงูุฑุถู ุณูุงูู ุฌุฏุงุฏ", "ูุญูุฏ ุจู ูุณูู ุจู ูุญูุฏ ูุณูู ุฌุฏุงุฏ", "ูุญูุฏ ุจู ูุงุตุฑ ุจู ุนุจุฏุงููู ุฌุฏุงุฏ", "ูุญูุฏ ุจู ููุซู ุจู ุณุงูู ูุงุฆู ุฌุฏุงุฏ ุงููุซูุฑู", "ูุณูู ุจู ุญุณู ุจู ูุงุฏู ุญุณู ุดุญุฑู ุฎูุงุฑ", "ูุนุงุฐ ูุคุงุฏ ุงูุญููุด ุงูุงุญูุฏ", "ูุงุตุฑ ุจู ุนูู ุจู ูุงุตุฑ ุณููู ุฌุฏุงุฏ", "ููุฑ ุงูุฏูู ูุญุณู ุงูุนูู", "ููุซู ุจู ูุญูุฏ ุจู ุณุงูู ูุงุฆู ุฌุฏุงุฏ"],
        "8-1": ["ุฃุญูุฏ ุจู ุณุนูุฏ ุจู ุจุฎูุช ุตูุฏู ุงููุญุฑูู", "ุฃุญูุฏ ุจู ุนุงูุฑ ุจู ูุญูุฏ ุณุงูู ุฎูุงุฑ", "ุฃุญูุฏ ุจู ูุญูุฏ ุจู ุณุงูู ูุจุงุฑู ุงููุณููู", "ุงููุฑ ุจู ุบุงูู ุจู ูุญูุฏ ุณููู ุงููุณููู ุงููุซูุฑู", "ุงูุงุฏ ุงุญูุฏ ุชูููู ุนุจุงุณ ูุตุทูู", "ุจุฎูุช ุจู ุฎุงูุฏ ุจู ุจุฎูุช ุฒุงูุฏ ูุณู", "ุจุฎูุช ุจู ุณุนูุฏุงู ุจู ุจุฎูุช ุฑููุฒู ุตูุฏู ุงููุญุฑูู", "ุญุงูู ุจู ููุฏ ุจู ุณุงูู ุฎููุชู ูุณู", "ุญุฑูุฒ ุจู ูุญุณู ุจู ุตุงูุญ ุญุฑูุฒ ุฎูุงุฑ", "ุญูุฏ ุจู ูุญูุฏ ุจู ุงูุนุจุฏ ุณููู ุฌุฏุงุฏ", "ุญูุฏ ุจู ูุญูุฏ ุจู ุณุนุฏ ุณุนูุฏ ุฌุฏุงุฏ", "ุญูุฏุงู ุจู ูุญูุฏ ุจู ุนุจุฏุงููู ูุญูุฏ ุฌุฏุงุฏ", "ุฒุงูุฏ ุจู ูุญูุฏ ุจู ูุณูู ุณุนูุฏ ุฌุฏุงุฏ", "ุณุนูุฏ ุจู ุฃุญูุฏ ุจู ูุญูุฏ ุงูุทูู ุงููุฒุงุฑ ุงููุซูุฑู", "ุณุนูุฏ ุจู ุญุงุชู ุจู ุณุนูุฏ ูุญูุฏ ุจูุช ูุณู", "ุณุนูุฏ ุจู ูุญูุฏ ุจู ุตุงูุญ ุงุญูุฏ ุฌุฏุงุฏ", "ุณุนูุฏ ุจู ุนุจุฏุงููู ุจู ูุจุฎูุช ุญูุงุฏู ุฌุฏุงุฏ", "ุณููู ุจู ุตุงูุญ ุจู ุจุฎูุช ุตุงูุญ ูููู ุฎูุงุฑ", "ุณููู ุจู ูุญุณู ุจู ุณููู ูุญููุธ ุฎูุงุฑ", "ุณููู ุจู ูุญูุฏ ุจู ุณุงูู ุนูู ุงูุญูุฑ", "ุณูู ุจู ุนุจุฏุงููู ุจู ูุณูู ูุญูุฏ ูุณู ุงููุซูุฑู", "ูุงุฆู ุจู ูุญูุฏ ุจู ูุงุฆู ูุทุฑ ุฌุฏุงุฏ", "ูุญูุฏ ุงุณูุงุนูู ุงุฏู ุนูู", "ูุญูุฏ ุจู ุณุงูู ุจู ุณุนูุฏ ุงููุญูุงุก ุฌุฏุงุฏ", "ูุญูุฏ ุจู ุณุนุฏ ุจู ูุณูู ุณุนูุฏ ุงูุฑุงุดุฏู", "ูุญูุฏ ุจู ูุณูู ุจู ุณุนูุฏ ุจุฎูุช ูุณู", "ูุญูุฏ ุจู ูุณูู ุจู ุณููู ูุทุฑ ุฌุฏุงุฏ", "ูุญูุฏ ูุตุทูู ุนุจุฏุงููุจู ุนุจุฏู", "ูุณูู ุจู ุญูุฏ ุจู ุณููู ูุณูู ุงูุฌููุจู", "ูุทุฑ ุจู ุนูู ุจู ุณุงูู ุนุงูุฑ ุงููุณููู", "ูุงุตุฑ ุจู ุณุงูู ุจู ูุญูุฏ ุงูุทูู ุงููุซูุฑู", "ุตุงูุญ ุฌุนูุฑ ุตุงูุญ ุนุจุฏ ุงููู"],
        "8-2": ["ุงูุฌููุฏู ุจู ููุธุงู ุจู ุณูููุงู ุณุงูู ุงููุงุตุฑู", "ุงูุฎุทุงุจ ูุญูุฏ ุตูุงุญ ูุญููุฏ", "ุชููู ุจู ููุซู ุจู ุงุญูุฏ ุณุนูุฏ ูุณู ุงููุซูุฑู", "ุฎุงูุฏ ุจู ูุญูุฏ ุจู ุณุงูู ุงุญูุฏ ุฌุฏุงุฏ", "ุฎุงูุฏ ุจู ูุงูู ุจู ุณุงูู ุนูุถุฉ ุฌุฏุงุฏ", "ุฑูุงุถ ุจู ุจุฎูุช ุจู ูุฑุฌ ุดููุงู ุนุฒุงุจ", "ุณุงูู ุจู ุญุงูุฏ ุจู ูุณูู ูุญูุฏ ูุณู ุงููุซูุฑู", "ุณุงูู ุจู ุนุงูุฑ ุจู ุณุงูู ุธูููุฑ ุฌุฏุงุฏ", "ุณุงูู ุณููู ุณุงูู ูุฑุฌ ุงูุฎูุงุฑ", "ุณุนุฏ ุจู ุญุงูู ุจู ุฃุญูุฏ ุฎูุงุฑ", "ุณุนูุฏ ุจู ุณุงูู ุจู ุณุนูุฏ ุณููู ูุณู", "ุณุนูุฏ ุจู ูุงุฆู ุจู ุนุจุฏุงููู ูุญูุฏ ุฌุฏุงุฏ", "ุณุนูุฏ ุจู ุฑุงูุงู ุจู ูุณูู ูุญูุฏ ูุณู ุงููุซูุฑู", "ุตุงูุญ ุจู ุนูู ุจู ุตุงูุญ ุนูู ุงููุณููู", "ุทุงุฑู ุงุญูุฏ ุถุงุญู ุนุจุฏุงูุบูู ุญุณูู", "ุทูุงู ุจู ูุณูู ุจู ุณุนูุฏ ุณููู ูุณู", "ุนุงูุฑ ุจู ุงุญูุฏ ุจู ูุจุฎูุช ูุณูู ูููู ุฎูุงุฑ", "ุนุจุฏุงูุนุฒูุฒ ุจู ููุตู ุจู ุณุนูุฏ ูุญูุฏ ุงููุณููู", "ุนุจุฏุงููู ุจู ุณุงูู ุจู ุฃุญูุฏ ุตุงูุญ ูุณู", "ุนูู ุฌูุนุงู ุณุงูู ุณุนูุฏ ููุณู", "ุนูุฑ ุจู ูุญูุฏ ุจู ุณูููุงู ูุญูุฏ ุงูููุฏู", "ุบููู ุจู ุนูุฑู ุจู ุบููู ุณุงูู ุฎูุงุฑ", "ูุงูู ูููุฏ ูุญูุฏ ูุคุงุฏ", "ูุญูุฏ ุจู ุณุนูุฏ ุจู ุตุงูุญ ุฃุญูุฏ ุฌุฏุงุฏ", "ูุญูุฏ ุจู ูุณูู ุจู ุณููู ูุญูุฏ ุงูุฑุงุดุฏู", "ูุณูู ุจู ุงุญูุฏ ุจู ูุณูู ุงูุฑุญุงุจู ุฌุฏุงุฏ", "ูุงุตุฑ ุจู ูุฑุดุฏ ุจู ุจุฎูุช ุนุจุฏุงููู ูุณู", "ูุงู ุจู ูุญูุฏ ุจู ุณุงูู ุจุฎูุช ุงููุซูุฑู", "ููุณู ุจู ุณุงูู ุจู ุนุงูุฑ ุณูุงูู ุฌุฏุงุฏ", "ูุญูุฏ ุญุณูู ุงูุนูู"]
    };

    function formatDate(date) {
        let d = new Date(date), month = '' + (d.getMonth() + 1), day = '' + d.getDate(), year = d.getFullYear();
        if (month.length < 2) month = '0' + month; if (day.length < 2) day = '0' + day;
        return [year, month, day].join('-');
    }
    const dKey = formatDate(new Date());

    function updateClock() {
        const now = new Date();
        document.getElementById('liveDate').innerText = now.toLocaleDateString('ar-OM', {weekday:'long', year:'numeric', month:'long', day:'numeric'});
        document.getElementById('liveTime').innerText = now.toLocaleTimeString('ar-OM');
    }
    setInterval(updateClock, 1000); updateClock();

    function adminShortcut() {
        clickCount = (window.clickCount || 0) + 1;
        window.clickCount = clickCount;
        if (clickCount === 3) { document.getElementById('loginArea').style.display = "block"; window.scrollTo(0,0); }
        setTimeout(() => { window.clickCount = 0; }, 2000);
    }

    function checkPassword() {
        if(document.getElementById('passInput').value === "12345678910") {
            document.getElementById('loginArea').style.display = "none";
            document.getElementById('adminPanel').style.display = "block";
            generateDetailedReport();
        } else { alert("ุงูุฑูุฒ ุบูุฑ ุตุญูุญ"); }
    }

    function fetchClassData() {
        const cls = document.getElementById('classSelect').value;
        const lsn = document.getElementById('lessonSelect').value;
        if(!cls) return;
        database.ref(`attendance/${dKey}/${cls}/L${lsn}`).once('value', (snap) => {
            const data = snap.val() || {};
            const list = document.getElementById('studentsList');
            list.innerHTML = "";
            ALL_STUDENTS[cls].forEach((name, i) => {
                let status = data[i]?.status || 'p';
                list.innerHTML += `<tr><td style="text-align:right">${name}</td><td>
                    <select id="stat${i}" onchange="updateTeacherStats('${cls}')" style="color:${status=='a'?'red':'green'}; font-weight:bold">
                        <option value="p" ${status=='p'?'selected':''}>ุญุงุถุฑ</option>
                        <option value="a" ${status=='a'?'selected':''}>ุบุงุฆุจ</option>
                    </select></td></tr>`;
            });
            document.getElementById('mainAppArea').style.display = "block";
            updateTeacherStats(cls);
        });
    }

    function updateTeacherStats(cls) {
        const total = ALL_STUDENTS[cls].length;
        let abs = 0;
        ALL_STUDENTS[cls].forEach((_, i) => { if(document.getElementById('stat'+i)?.value === 'a') abs++; });
        document.getElementById('teacherStats').style.display = 'grid';
        document.getElementById('tTotal').innerText = total;
        document.getElementById('tAbs').innerText = abs;
        document.getElementById('tPerc').innerText = Math.round(((total-abs)/total)*100) + '%';
    }

    function pushToCloud() {
        const cls = document.getElementById('classSelect').value;
        const lsn = document.getElementById('lessonSelect').value;
        let data = {};
        ALL_STUDENTS[cls].forEach((_, i) => { data[i] = { status: document.getElementById('stat'+i).value }; });
        database.ref(`attendance/${dKey}/${cls}/L${lsn}`).set(data).then(() => alert("ุชู ุงูุญูุธ ุจูุฌุงุญ โ"));
    }

    function generateDetailedReport() {
        const selDate = document.getElementById('archiveDate').value || dKey;
        database.ref('attendance/' + selDate).once('value', (snap) => {
            const data = snap.val() || {};
            const area = document.getElementById('detailedReportArea');
            const statsTable = document.getElementById('classesStatsBody');
            area.innerHTML = ""; statsTable.innerHTML = "";
            let sTotal = 0, sAbs = 0;

            Object.keys(ALL_STUDENTS).forEach(clsId => {
                let absList = new Set();
                sTotal += ALL_STUDENTS[clsId].length;
                for(let l=1; l<=7; l++) {
                    if(data[clsId]?.['L'+l]) {
                        ALL_STUDENTS[clsId].forEach((name, i) => { if(data[clsId]['L'+l][i]?.status === 'a') absList.add(name); });
                    }
                }
                sAbs += absList.size;
                let perc = Math.round(((ALL_STUDENTS[clsId].length - absList.size) / ALL_STUDENTS[clsId].length) * 100);
                statsTable.innerHTML += `<tr><td>${clsId}</td><td>${ALL_STUDENTS[clsId].length}</td><td style="color:red">${absList.size}</td><td>${perc}%</td></tr>`;
                if(absList.size > 0) area.innerHTML += `<div class="card"><b>ุบุงุฆุจูู ${clsId}</b><br>${Array.from(absList).map(n => `<span class="name-tag">${n}</span>`).join('')}</div>`;
            });
            document.getElementById('sTotal').innerText = sTotal;
            document.getElementById('sAbs').innerText = sAbs;
            document.getElementById('sPresPerc').innerText = Math.round(((sTotal-sAbs)/sTotal)*100) + '%';
            document.getElementById('sAbsPerc').innerText = Math.round((sAbs/sTotal)*100) + '%';
        });
    }

    function showSuggestions(q) {
        const list = document.getElementById('suggestionsList');
        if (q.length < 2) { list.style.display = 'none'; return; }
        let matches = [];
        for (let cls in ALL_STUDENTS) ALL_STUDENTS[cls].forEach(name => { if(name.includes(q)) matches.push({name, cls}); });
        list.innerHTML = matches.map(m => `<div class="suggestion-item" onclick="selectStudent('${m.name}')">${m.name} <small>(${m.cls})</small></div>`).join('');
        list.style.display = matches.length ? 'block' : 'none';
    }

    function selectStudent(n) {
        document.getElementById('globalSearchInput').value = n;
        document.getElementById('suggestionsList').style.display = 'none';
        searchHistory(n);
    }

    function searchHistory(name) {
        database.ref('attendance').once('value', (snap) => {
            const data = snap.val(); let history = [];
            for(let d in data) {
                let abs = false;
                for(let c in data[d]) for(let l in data[d][c]) for(let i in data[d][c][l])
                    if(ALL_STUDENTS[c][i] === name && data[d][c][l][i].status === 'a') abs = true;
                if(abs) history.push(d);
            }
            document.getElementById('searchResultArea').innerHTML = history.length ? 
                `<div class="card" style="border-right:5px solid red;"><b>${name}</b><br>ุบุงุจ ${history.length} ุฃูุงู:<br><small>${history.join(' | ')}</small></div>` : 
                "<div class='card' style='color:green;'>ูุง ููุฌุฏ ุบูุงุจ ูุณุฌู.</div>";
        });
    }

    function exportToExcel() {
        database.ref('attendance').once('value', (snap) => {
            const allData = snap.val();
            if (!allData) return alert("ูุง ุชูุฌุฏ ุจูุงูุงุช!");
            let csv = "\ufeffุงูุชุงุฑูุฎ,ุงูุตู,ุงูุญุตุฉ,ุงุณู ุงูุทุงูุจ\n";
            for (let d in allData) for (let c in allData[d]) for (let l in allData[d][c]) for (let i in allData[d][c][l])
                if (allData[d][c][l][i].status === 'a') csv += `${d},${c},${l.replace('L','')},${ALL_STUDENTS[c][i]}\n`;
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `ุบูุงุจ_ูุฏุฑุณุฉ_ูุฒูุฏ_${new Date().toLocaleDateString()}.csv`;
            link.click();
        });
    }
</script>
</body>
</html>
