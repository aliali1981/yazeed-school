<div class="card" style="background: #e3f2fd; border: 2px solid #2196f3;">
    <h4 style="margin-top:0; color: #0d47a1;">ğŸ“¥ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù„Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± (Excel)</h4>
    <p style="font-size: 0.8rem; color: #555;">Ø³ÙŠÙ‚ÙˆÙ… Ù‡Ø°Ø§ Ø§Ù„Ø²Ø± Ø¨ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØºÙŠØ§Ø¨ Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ø¨ØµÙŠØºØ© Excel CSV.</p>
    <button onclick="exportToExcel()" style="background: #2196f3; color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; width: 100%; font-weight: bold;">
        ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„ØºÙŠØ§Ø¨ Ø§Ù„Ø´Ø§Ù…Ù„ â¬‡ï¸
    </button>
</div>

<script>
// Ø£Ø¶Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ© ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ù‚Ø³Ù… Ø§Ù„Ù€ <script>
function exportToExcel() {
    database.ref('attendance').once('value', (snap) => {
        const allData = snap.val();
        if (!allData) {
            alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§ Ø­Ø§Ù„ÙŠØ§Ù‹!");
            return;
        }

        let csvContent = "\ufeff"; // Ù„Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙÙŠ Excel
        csvContent += "Ø§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ù„ØµÙ,Ø§Ù„Ø­ØµØ©,Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨\n";

        for (let date in allData) {
            for (let cls in allData[date]) {
                for (let lesson in allData[date][cls]) {
                    for (let index in allData[date][cls][lesson]) {
                        if (allData[date][cls][lesson][index].status === 'a') {
                            let studentName = ALL_STUDENTS[cls][index];
                            let lessonNum = lesson.replace('L', '');
                            // Ø¥Ø¶Ø§ÙØ© Ø³Ø·Ø± Ù„ÙƒÙ„ ØºÙŠØ§Ø¨
                            csvContent += `${date},${cls},${lessonNum},${studentName}\n`;
                        }
                    }
                }
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement("a");
        const url = URL.createObjectURL(blob);
        link.setAttribute("href", url);
        link.setAttribute("download", `Ø³Ø¬Ù„_ØºÙŠØ§Ø¨_Ù…Ø¯Ø±Ø³Ø©_ÙŠØ²ÙŠØ¯_${new Date().toLocaleDateString()}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    });
}
</script>
